<!DOCTYPE html>
<html lang="en">





<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="description" content="Validation이번 시간에는 Spring Validation에 대해 알아보려고 합니다.클라이언트가 값들을 서버에 보낼 때 클라이언트에서 이 값이 유효한 값인지 한번 검사하고 서버에게 보냅니다.하지만 클라이언트는 변조의 가능성이 있기 때문에, 서버쪽에서 한번 더 유효성검사를 한 ...">
  <meta name="keywords" content="민동현 and spring">
  <meta name="author" content="Spring Validation | 민동현의 블로그">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#f5f5f5">

  <!-- Twitter Tags -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Spring Validation | 민동현의 블로그">
  <meta name="twitter:description" content="Validation이번 시간에는 Spring Validation에 대해 알아보려고 합니다.클라이언트가 값들을 서버에 보낼 때 클라이언트에서 이 값이 유효한 값인지 한번 검사하고 서버에게 보냅니다.하지만 클라이언트는 변조의 가능성이 있기 때문에, 서버쪽에서 한번 더 유효성검사를 한 ...">
  
    <meta property="twitter:image" content="http://localhost:4000/img/leonids-logo.png">
  

  <!-- Open Graph Tags -->
  <meta property="og:type" content="blog">
  <meta property="og:url" content="http://localhost:4000/articles/2019-11/Spring-Validation-index">
  <meta property="og:title" content="Spring Validation | 민동현의 블로그">
  <meta property="og:description" content="Validation이번 시간에는 Spring Validation에 대해 알아보려고 합니다.클라이언트가 값들을 서버에 보낼 때 클라이언트에서 이 값이 유효한 값인지 한번 검사하고 서버에게 보냅니다.하지만 클라이언트는 변조의 가능성이 있기 때문에, 서버쪽에서 한번 더 유효성검사를 한 ...">
  
    <meta property="og:image" content="http://localhost:4000/img/leonids-logo.png">
  
  <title>Spring Validation | 민동현의 블로그</title>

  <!-- CSS files -->
  <link rel="stylesheet" href="http://localhost:4000/css/font-awesome.min.css">
  <link rel="stylesheet" href="http://localhost:4000/css/main.css">

  <link rel="canonical" href="http://localhost:4000/articles/2019-11/Spring-Validation-index">
  <link rel="alternate" type="application/rss+xml" title="민동현의 블로그" href="http://localhost:4000/feed.xml" />

  <!-- Icons -->
  <!-- 16x16 -->
  <link rel="shortcut icon" href="http://localhost:4000/favicon.ico">
  <!-- 32x32 -->
  <link rel="shortcut icon" href="http://localhost:4000/favicon.png">
</head>


<body>
  <div class="row">
    <div class="col s12 m3">
      <div class="table cover">
        

<div class="cover-card table-cell table-middle">
  
  <a href="http://localhost:4000/">
    <img src="http://localhost:4000/img/profile.jpg" alt="" class="avatar">
  </a>
  
  <a href="http://localhost:4000/" class="author_name">민동현</a>
  <span class="author_job">Back End Developer</span>
  <span class="author_bio mbm">JAVA 개발자</span>
  <nav class="nav">
    <ul class="nav-list">
      <li class="nav-item">
        <a href="http://localhost:4000/">home</a>
      </li>
       
      <li class="nav-item">
        <a href="http://localhost:4000/archive/">Archive</a>
      </li>
          
      <li class="nav-item">
        <a href="http://localhost:4000/categories/">Categories</a>
      </li>
             
    </ul>
  </nav>
  <script type="text/javascript">
  // based on http://stackoverflow.com/a/10300743/280842
  function gen_mail_to_link(hs, subject) {
    var lhs,rhs;
    var p = hs.split('@');
    lhs = p[0];
    rhs = p[1];
    document.write("<a class=\"social-link-item\" target=\"_blank\" href=\"mailto");
    document.write(":" + lhs + "@");
    document.write(rhs + "?subject=" + subject + "\"><i class=\"fa fa-fw fa-envelope\"></i><\/a>");
  }
</script>
<div class="social-links">
  <ul>
    
      <li>
      <script>gen_mail_to_link('mindh890@gmail.com', 'Hello from website');</script>
      </li>
    
    
    
    
    <li><a href="http://linkedin.com/in/동현-민-736913183" class="social-link-item" target="_blank"><i class="fa fa-fw fa-linkedin"></i></a></li>
    
    
    
    
    <li><a href="http://github.com/DaeAkin" class="social-link-item" target="_blank"><i class="fa fa-fw fa-github"></i></a></li>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <li><a href="https://t.me/DonghyeonMin" class="social-link-item" target="_blank"><i class="fa fa-fw fa-telegram"></i></a></li>
  </ul>
</div>

</div>

      </div>
    </div>
    <div class="col s12 m9">
      <div class="post-listing">
        <a class="btn" href= "http://localhost:4000/" >
  Home
</a>



<div id="post">
  <header class="post-header">
    <h1 title="Spring Validation">Spring Validation</h1>
    <span class="post-meta">
      <span class="post-date">
        9 NOV 2019
      </span>
      •
      <span class="read-time" title="Estimated read time">
  
  
    13 mins read
  
</span>

    </span>

  </header>

  <article class="post-content">
    <h1 id="validation">Validation</h1>

<p>이번 시간에는 Spring Validation에 대해 알아보려고 합니다.</p>

<p>클라이언트가 값들을 서버에 보낼 때 클라이언트에서 이 값이 유효한 값인지 한번 검사하고 서버에게 보냅니다.</p>

<p>하지만 클라이언트는 변조의 가능성이 있기 때문에, 서버쪽에서 한번 더 유효성검사를 한 뒤 저장해야합니다.</p>

<p>이런 작업을 Validation(유효성 검사) 라고 합니다.</p>

<p>Spring에서는 파라미터에 @Valid 어노테이션을 붙여주면 쉽게 유효성 검사를 해줄 수 있습니다.</p>

<p><a href="https://github.com/DaeAkin/spring-validation-example">git 코드</a></p>

<h2 id="1-요구사항">1. 요구사항</h2>

<h3 id="1-1-회원가입-요구사항">1-1. 회원가입 요구사항</h3>

<ul>
  <li>휴대폰번호는 10자리이상 11자리 이하여야 한다.</li>
  <li>이메일은 올바른 형식이어야 한다.</li>
</ul>

<p>기본으로 Ajax 통신을하여 Restful 방식을 이용하고, view단은 thymeleaf를 사용했습니다.</p>

<p>간단한 디자인은 BootStrap을 이용했습니다.</p>

<p><img src="https://github.com/DaeAkin/DaeAkin.github.io/blob/master/_posts/2019-11-09-Spring%20Validation/img/image1.png?raw=true" alt="" /></p>

<h2 id="2-gradle">2. Gradle</h2>

<div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plugins</span> <span class="o">{</span>
	<span class="n">id</span> <span class="s1">'org.springframework.boot'</span> <span class="n">version</span> <span class="s1">'2.0.5.RELEASE'</span>
	<span class="n">id</span> <span class="s1">'io.spring.dependency-management'</span> <span class="n">version</span> <span class="s1">'1.0.8.RELEASE'</span>
	<span class="n">id</span> <span class="s1">'java'</span>
<span class="o">}</span>

<span class="n">group</span> <span class="o">=</span> <span class="s1">'com.validation'</span>
<span class="n">version</span> <span class="o">=</span> <span class="s1">'0.0.1-SNAPSHOT'</span>
<span class="n">sourceCompatibility</span> <span class="o">=</span> <span class="s1">'1.8'</span>

<span class="n">configurations</span> <span class="o">{</span>
	<span class="n">developmentOnly</span>
	<span class="n">runtimeClasspath</span> <span class="o">{</span>
		<span class="n">extendsFrom</span> <span class="n">developmentOnly</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="n">repositories</span> <span class="o">{</span>
	<span class="n">mavenCentral</span><span class="o">()</span>
<span class="o">}</span>

<span class="n">dependencies</span> <span class="o">{</span>
	<span class="n">implementation</span> <span class="s1">'org.springframework.boot:spring-boot-starter-data-jpa'</span>
	<span class="n">implementation</span> <span class="s1">'org.springframework.boot:spring-boot-starter-web'</span>
	<span class="n">developmentOnly</span> <span class="s1">'org.springframework.boot:spring-boot-devtools'</span>
	<span class="n">runtimeOnly</span> <span class="s1">'com.h2database:h2'</span>
	<span class="n">testImplementation</span> <span class="s1">'org.springframework.boot:spring-boot-starter-test'</span>
	<span class="n">implementation</span> <span class="s1">'org.springframework.boot:spring-boot-starter-thymeleaf'</span>

	<span class="n">compileOnly</span><span class="o">(</span><span class="s1">'org.projectlombok:lombok:1.18.4'</span><span class="o">)</span>
	<span class="n">testCompileOnly</span><span class="o">(</span><span class="s1">'org.projectlombok:lombok:1.18.4'</span><span class="o">)</span>
	<span class="n">annotationProcessor</span> <span class="s1">'org.projectlombok:lombok:1.18.8'</span>

<span class="o">}</span>

</code></pre></div></div>

<p>빠른 예제 셋팅을 위해 인메모리 H2 DB를 사용했습니다.</p>

<p>ORM은 JPA를 이용했습니다.</p>

<p>Getter와 생성자 등 빠르게 만들어 주기 위해 lombok도 사용했습니다.</p>

<h2 id="3-memberclass">3. Member.class</h2>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Entity</span>
<span class="nd">@NoArgsConstructor</span>
<span class="nd">@AllArgsConstructor</span>
<span class="nd">@Builder</span>
<span class="nd">@Getter</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Member</span> <span class="o">{</span>

    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span><span class="o">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="nc">GenerationType</span><span class="o">.</span><span class="na">IDENTITY</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">String</span> <span class="n">phoneNumber</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">String</span> <span class="n">email</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Member 엔티티 클래스를 만들었습니다.</p>

<p>기본키 생성은 데이터베이스에세 위임했습니다.</p>

<h2 id="4-membersaverequestclass">4. MemberSaveRequest.class</h2>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Data</span>
<span class="nd">@Builder</span>
<span class="nd">@NoArgsConstructor</span>
<span class="nd">@AllArgsConstructor</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MemberSaveRequest</span> <span class="o">{</span>

    <span class="nd">@NotBlank</span><span class="o">(</span><span class="n">message</span> <span class="o">=</span> <span class="s">"휴대폰번호를 입력해주세요."</span><span class="o">)</span>
    <span class="nd">@Pattern</span><span class="o">(</span><span class="n">regexp</span> <span class="o">=</span> <span class="s">"[0-9]{10,11}"</span><span class="o">,</span> <span class="n">message</span> <span class="o">=</span> <span class="s">"10~11자리의 숫자만 입력가능합니다"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">phoneNumber</span><span class="o">;</span>

    <span class="nd">@NotBlank</span><span class="o">(</span><span class="n">message</span> <span class="o">=</span> <span class="s">"이메일을 입력해주세요."</span><span class="o">)</span>
    <span class="nd">@Email</span><span class="o">(</span><span class="n">message</span> <span class="o">=</span> <span class="s">"이메일을 확인해주세요."</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">email</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nc">Member</span> <span class="nf">toEntity</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nc">Member</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
                <span class="o">.</span><span class="na">phoneNumber</span><span class="o">(</span><span class="n">phoneNumber</span><span class="o">)</span>
                <span class="o">.</span><span class="na">email</span><span class="o">(</span><span class="n">email</span><span class="o">)</span>
                <span class="o">.</span><span class="na">build</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<blockquote>
  <p>Member가 저장될 때 사용할 DTO 클래스를 하나 만들었습니다. 
Member클래스가 있음에도 DTO 클래스를 만든 이유는 SOLID 규칙 중 하나인  <code class="language-plaintext highlighter-rouge">단일 책임 원칙</code>때문입니다. 
Member 클래스는 현재 JPA의 Entity의 역할을 하고 있기 때문에, 유효성검사를 해주는 작업까지 해주게되면 
책임이 많아지게 됩니다.</p>
</blockquote>

<p>휴대폰번호는 숫자 0~9사이를 받고 10자리 이상 11자리이하입니다.</p>

<p>이메일은 이메일 형식을 지키도록 했습니다.</p>

<h2 id="5-membercontrollerclass">5. MemberController.class</h2>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/member"</span><span class="o">)</span>
<span class="nd">@Slf4j</span>
<span class="nd">@AllArgsConstructor</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MemberController</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">MemberRepository</span> <span class="n">memberRepository</span><span class="o">;</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/join"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">moveToMemberJoinViewPage</span><span class="o">(</span><span class="nc">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>

        <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">&gt;</span> <span class="n">memberList</span> <span class="o">=</span> <span class="o">(</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">&gt;)</span> <span class="n">memberRepository</span><span class="o">.</span><span class="na">findAll</span><span class="o">();</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"memberList"</span><span class="o">,</span> <span class="n">memberList</span><span class="o">);</span>

        <span class="k">return</span> <span class="s">"member_join"</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>회원가입 페이지로 넘어가게 해주는 Controller 입니다.</p>

<h2 id="6-memberrestcontroller">6. MemberRestController</h2>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@RestController</span>
<span class="nd">@AllArgsConstructor</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/api/member"</span><span class="o">)</span>
<span class="nd">@Slf4j</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MemberRestController</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="nc">MemberRepository</span> <span class="n">memberRepository</span><span class="o">;</span>

    <span class="nd">@PostMapping</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">insertMember</span><span class="o">(</span><span class="nd">@Valid</span> <span class="nd">@RequestBody</span> <span class="nc">MemberSaveRequest</span> <span class="n">memberSaveRequest</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"insertMember {} "</span> <span class="o">,</span> <span class="n">memberSaveRequest</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
        <span class="n">memberRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">memberSaveRequest</span><span class="o">.</span><span class="na">toEntity</span><span class="o">());</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div>

<p>MemberRepository에 @Autowired 어노테이션이 없는걸 확인하실 수 있습니다.</p>

<p>Lombok의 @AllArgsConstructor 때문인데요,
룸북이 자동적으로 생성자를 만들어 injection을 해주기 때문입니다.</p>

<p>MemberSaveRequest는 body를 읽어야 하기때문에 @ReqeustBody 어노테이션을 붙여줬고, 유효성 검사를 하기 때문에 @Valid 어노테이션을 붙여줬습니다.</p>

<h2 id="7-단위-테스트">7. 단위 테스트</h2>
<p>MemberSaveRequest에서 설정한 유효성 검사들이 제대로 이루어지고 있는지 확인하려면 어떻게 해야 할까요?
직접 회원가입 폼을 만들어 회원가입을 해서 로그를 찍어보는 방법이 있습니다.
하지만 그런 방법은 테스트하는 시간이 많이 들어서 효율적이지가 않습니다.</p>

<p>가장 효율적인 방법은 테스트코드를 짜서 실행해보는 것이 가장 효율적입니다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="n">validation_</span><span class="err">테스트</span><span class="o">()</span> <span class="o">{</span>
      <span class="nc">ValidatorFactory</span> <span class="n">validatorFactory</span> <span class="o">=</span> <span class="nc">Validation</span><span class="o">.</span><span class="na">buildDefaultValidatorFactory</span><span class="o">();</span>
      <span class="nc">Validator</span> <span class="n">validator</span> <span class="o">=</span> <span class="n">validatorFactory</span><span class="o">.</span><span class="na">getValidator</span><span class="o">();</span>

      <span class="nc">MemberSaveRequest</span> <span class="n">memberSaveRequest</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MemberSaveRequest</span><span class="o">();</span>

      <span class="n">memberSaveRequest</span><span class="o">.</span><span class="na">setEmail</span><span class="o">(</span><span class="s">"mindh890@gmail.com"</span><span class="o">);</span>
      <span class="n">memberSaveRequest</span><span class="o">.</span><span class="na">setPhoneNumber</span><span class="o">(</span><span class="s">"01011114444"</span><span class="o">);</span>
      <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">ConstraintViolation</span><span class="o">&lt;</span><span class="nc">MemberSaveRequest</span><span class="o">&gt;&gt;</span> <span class="n">violations</span> <span class="o">=</span> <span class="n">validator</span><span class="o">.</span><span class="na">validate</span><span class="o">(</span><span class="n">memberSaveRequest</span><span class="o">);</span>

      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"violations : "</span> <span class="o">+</span> <span class="n">violations</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>

      <span class="c1">//유효성이 성공적으로 통과됐으면 empty</span>
      <span class="c1">//그렇지 않으면 not empty</span>
      <span class="n">assertTrue</span><span class="o">(</span><span class="n">violations</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">());</span>

      <span class="n">validatorFactory</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>

  <span class="o">}</span>

</code></pre></div></div>
<p>MemberSaveRequest객체가 유효하지 않다면 violations 변수는 empty가 되지않고 유효성을 통과하지 못한 필드가 안에 남습니다.</p>

<p>패턴이 유효한지 테스트할때 요긴하게 사용됩니다.</p>

<h2 id="8-postman으로-테스트하기">8. PostMan으로 테스트하기</h2>

<p><img src="https://github.com/DaeAkin/DaeAkin.github.io/blob/master/_posts/2019-11-09-Spring%20Validation/img/image2.png?raw=true" alt="" /></p>

<p>그렇다면 스프링에서는 유효성 검사에 실패하게되면 어떤 값들을 return 할까요?
PostMan으로 값을 테스트하여 유효성 검사에 실패하도록 만들어보겠습니다.
다음은 email을 빈값으로 두고 서버에 전송하여 리턴받은 값들입니다.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"timestamp"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2019-11-07T04:34:03.517+0000"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"status"</span><span class="p">:</span><span class="w"> </span><span class="mi">400</span><span class="p">,</span><span class="w">
    </span><span class="nl">"error"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Bad Request"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"errors"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nl">"codes"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="s2">"NotBlank.memberSaveRequest.email"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"NotBlank.email"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"NotBlank.java.lang.String"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"NotBlank"</span><span class="w">
            </span><span class="p">],</span><span class="w">
            </span><span class="nl">"arguments"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="nl">"codes"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                        </span><span class="s2">"memberSaveRequest.email"</span><span class="p">,</span><span class="w">
                        </span><span class="s2">"email"</span><span class="w">
                    </span><span class="p">],</span><span class="w">
                    </span><span class="nl">"arguments"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
                    </span><span class="nl">"defaultMessage"</span><span class="p">:</span><span class="w"> </span><span class="s2">"email"</span><span class="p">,</span><span class="w">
                    </span><span class="nl">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"email"</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">],</span><span class="w">
            </span><span class="nl">"defaultMessage"</span><span class="p">:</span><span class="w"> </span><span class="s2">"이메일을 입력해주세요."</span><span class="p">,</span><span class="w">
            </span><span class="nl">"objectName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"memberSaveRequest"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"field"</span><span class="p">:</span><span class="w"> </span><span class="s2">"email"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"rejectedValue"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
            </span><span class="nl">"bindingFailure"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
            </span><span class="nl">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"NotBlank"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nl">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Validation failed for object='memberSaveRequest'. Error count: 1"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"path"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/api/member"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>HttpStatus는 400으로 BAD_REQUEST를 응답받았고,
errors 리스트로 오류내용들이 나옵니다.
그 안에 defaultMessage는 MemberSaveRequest에서 정한 값이 넘어온걸 확인할 수 있고, 어떤 field가 오류인지도 확인할 수 있습니다.</p>

<p>이 값들을 바탕으로 사용자가 확인할 수 있도록 회원가입 폼에 노출시켜주면 됩니다.</p>

<h2 id="9-member_joinhtml">9. member_join.html</h2>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;body</span> <span class="na">id=</span><span class="s">"page-top"</span><span class="nt">&gt;</span>
<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"wrapper"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"content-wrapper"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container-fluid"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container p-5"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;form&gt;</span>
                    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"alert alert-primary"</span> <span class="na">role=</span><span class="s">"alert"</span><span class="nt">&gt;</span>
                        회원가입
                    <span class="nt">&lt;/div&gt;</span>
                    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"email"</span><span class="nt">&gt;</span>이메일<span class="nt">&lt;/label&gt;</span>
                        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"email"</span> <span class="na">class=</span><span class="s">"form-control"</span> <span class="na">name=</span><span class="s">"email"</span> <span class="na">id=</span><span class="s">"email"</span> <span class="na">aria-describedby=</span><span class="s">"emailHelp"</span>
                               <span class="na">placeholder=</span><span class="s">"Enter email"</span><span class="nt">&gt;</span>

                    <span class="nt">&lt;/div&gt;</span>
                    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"phoneNumber"</span><span class="nt">&gt;</span>휴대폰번호<span class="nt">&lt;/label&gt;</span>
                        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">class=</span><span class="s">"form-control"</span> <span class="na">id=</span><span class="s">"phoneNumber"</span> <span class="na">name=</span><span class="s">"phoneNumber"</span>
                               <span class="na">placeholder=</span><span class="s">"Phone Number"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;/div&gt;</span>
                    <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">id=</span><span class="s">"saveButton"</span> <span class="na">class=</span><span class="s">"btn btn-primary"</span><span class="nt">&gt;</span>회원가입<span class="nt">&lt;/button&gt;</span>
                <span class="nt">&lt;/form&gt;</span>
            <span class="nt">&lt;/div&gt;</span>

        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div></div>

<h3 id="9-1-member_joinhtml-안에있는-자바스크립트-소스">9-1. member_join.html 안에있는 자바스크립트 소스</h3>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#saveButton</span><span class="dl">'</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">{</span>
                <span class="na">phoneNumber</span><span class="p">:</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#phoneNumber</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span>
                <span class="na">email</span><span class="p">:</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#email</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span>
            <span class="p">};</span>
            <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
                <span class="na">url</span><span class="p">:</span><span class="dl">'</span><span class="s1">/api/member</span><span class="dl">'</span><span class="p">,</span>
                <span class="na">method</span><span class="p">:</span> <span class="dl">'</span><span class="s1">POST</span><span class="dl">'</span><span class="p">,</span>
                <span class="na">data</span><span class="p">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">data</span><span class="p">),</span>
                <span class="na">contentType</span><span class="p">:</span> <span class="dl">"</span><span class="s2">application/json; charset=utf-8</span><span class="dl">"</span><span class="p">,</span>
                <span class="na">success</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">alert</span><span class="p">(</span><span class="dl">"</span><span class="s2">회원가입 성공</span><span class="dl">"</span><span class="p">);</span>
                    <span class="nx">location</span><span class="p">.</span><span class="nx">reload</span><span class="p">();</span>
                <span class="p">},</span>
                <span class="na">error</span> <span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">markingErrorField</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">});</span>
        <span class="p">});</span>


<span class="kd">var</span> <span class="nx">markingErrorField</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">errorFields</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">responseJSON</span><span class="p">.</span><span class="nx">errors</span><span class="p">;</span>

    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">errorFields</span><span class="p">){</span>
        <span class="nx">alert</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">response</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">$field</span><span class="p">,</span> <span class="nx">error</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nx">length</span> <span class="o">=</span> <span class="nx">errorFields</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">length</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">){</span>
        <span class="nx">error</span> <span class="o">=</span> <span class="nx">errorFields</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
        <span class="nx">$field</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#</span><span class="dl">'</span><span class="o">+</span><span class="nx">error</span><span class="p">[</span><span class="dl">'</span><span class="s1">field</span><span class="dl">'</span><span class="p">]);</span>

        <span class="k">if</span><span class="p">(</span><span class="nx">$field</span> <span class="o">&amp;&amp;</span> <span class="nx">$field</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">){</span>
            <span class="nx">$field</span><span class="p">.</span><span class="nx">siblings</span><span class="p">(</span><span class="dl">'</span><span class="s1">.error-message</span><span class="dl">'</span><span class="p">).</span><span class="nx">remove</span><span class="p">();</span>
            <span class="nx">$field</span><span class="p">.</span><span class="nx">after</span><span class="p">(</span><span class="dl">'</span><span class="s1">&lt;span class="error-message text-muted taxt-small text-danger"&gt;</span><span class="dl">'</span><span class="o">+</span><span class="nx">error</span><span class="p">.</span><span class="nx">defaultMessage</span><span class="o">+</span><span class="dl">'</span><span class="s1">&lt;/span&gt;</span><span class="dl">'</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<p>Ajax 통신하기 위해서 회원가입 버튼을 누를 경우 /api/member 을 호출하여 데이터를 저장하도록 했습니다.</p>

<p>만약 서버에서 유효성 검사를 하게되면 400 에러를 반환할테니 error 부분에다가 
error 발생시 동작할 코드나 함수를 적어주면 되는데, erros.defaultMessage 를 해당 필드에 노출시키도록 했습니다.</p>

<h2 id="10-유효성-테스트---이메일과-비밀번호를-빈칸으로-둘-경우">10. 유효성 테스트 - 이메일과 비밀번호를 빈칸으로 둘 경우</h2>

<p><img src="https://github.com/DaeAkin/DaeAkin.github.io/blob/master/_posts/2019-11-09-Spring%20Validation/img/image3.png?raw=true" alt="" /></p>

<h2 id="11-회원가입이-된-경우">11. 회원가입이 된 경우</h2>

<p><img src="https://github.com/DaeAkin/DaeAkin.github.io/blob/master/_posts/2019-11-09-Spring%20Validation/img/image4.png?raw=true" alt="" /></p>

<p>지금까지는 컨트롤러로 들어오는 파라미터의 대한 Validation만 검사해줬습니다.</p>

<p>만약 휴대폰번호가 유일해야하는 조건이 생긴다면 어떻게 해야할까요?</p>

<p>휴대폰번호가 이미 데이터베이스에 존재하는지 확인해주는 메소드와 서비스클래스를 만들겠습니다.</p>

<h2 id="12-휴대폰-번호-중복검사">12. 휴대폰 번호 중복검사</h2>

<h3 id="12-1-memberrepository">12-1. MemberRepository</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Repository</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">MemberRepository</span> <span class="kd">extends</span> <span class="nc">CrudRepository</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">,</span><span class="nc">Long</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="nc">Optional</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">&gt;</span> <span class="nf">findByPhoneNumber</span><span class="o">(</span><span class="nc">String</span> <span class="n">phoneNumber</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="12-2-memberservice">12-2. MemberService</h3>

<p><img src="https://github.com/DaeAkin/spring-validation-example/blob/master/image/RuntimeException.png?raw=true" alt="" /></p>

<p>유효성검사에 실패하게되면 RuntimeException이 일어나 애플리케이션이 종료시키게 했습니다.</p>

<p>그럼 중복된 휴대폰번호로 회원가입을 시켜보겠습니다.</p>

<h2 id="13-runtimeexception-이용">13. RuntimeException 이용</h2>

<p><img src="https://github.com/DaeAkin/spring-validation-example/blob/master/image/%EC%9E%98%EB%AA%BB%EB%90%9C%20RuntimeException.png?raw=true" alt="" /></p>

<p>회원가입한 사람은 500에러를 보게되며, UI에 아무것도 변화가 없습니다.</p>

<p>일반 사용자가 이런 상황을 맞이한다면 좋지못한 UX가 될 것입니다.</p>

<p>서버가 RuntimeException을 낸다면 어떤 값들이 응답으로 나오는지 알아보겠습니다.</p>

<h3 id="13-1-postman으로-runtimeexception-응답-알아보기">13-1. PostMan으로 RuntimeException 응답 알아보기.</h3>

<p><img src="https://github.com/DaeAkin/spring-validation-example/blob/master/image/Postman%20RuntimeException.png?raw=true" alt="" /></p>

<p>컨트롤러에서 @Valid 어노테이션이 붙은 객체가 유효성 검사를 통과하지못하면 반환하는 응답하고 비슷한 것 같습니다.</p>

<p>이 점을 이용해서 에러가 났을 경우 반환되는 필드들을 커스터마이징 해보겠습니다.</p>

<h2 id="14-validationexcpetion-이용하기">14. ValidationExcpetion 이용하기.</h2>

<h3 id="14-1-validationexcpetion">14-1. ValidationExcpetion</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 * errorCode : 1004 -&gt; 화면전환 필요 및 Toast 메세지 필요
 *
 */</span>
<span class="nd">@ResponseStatus</span><span class="o">(</span><span class="nc">HttpStatus</span><span class="o">.</span><span class="na">BAD_REQUEST</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ValidationException</span> <span class="kd">extends</span> <span class="nc">RuntimeException</span><span class="o">{</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">errorCode</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">errorMessage</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">Error</span><span class="o">[]</span> <span class="n">errors</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">ValidationException</span><span class="o">(</span><span class="nc">Long</span> <span class="n">errorCode</span><span class="o">,</span> <span class="nc">String</span> <span class="n">errorMessage</span><span class="o">,</span> <span class="nc">String</span> <span class="n">defaultMessage</span><span class="o">,</span> <span class="nc">String</span> <span class="n">field</span><span class="o">){</span>
        <span class="k">this</span><span class="o">.</span><span class="na">errorCode</span> <span class="o">=</span> <span class="n">errorCode</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">errorMessage</span> <span class="o">=</span> <span class="n">errorMessage</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">errors</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Error</span><span class="o">[]{</span><span class="k">new</span> <span class="nc">Error</span><span class="o">(</span><span class="n">defaultMessage</span><span class="o">,</span> <span class="n">field</span><span class="o">)};</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nf">ValidationException</span><span class="o">(</span><span class="nc">Long</span> <span class="n">errorCode</span><span class="o">,</span> <span class="nc">String</span> <span class="n">errorMessage</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">errorCode</span> <span class="o">=</span> <span class="n">errorCode</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">errorMessage</span> <span class="o">=</span> <span class="n">errorMessage</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nf">ValidationException</span><span class="o">(</span><span class="nc">String</span> <span class="n">errorMessage</span><span class="o">){</span>
        <span class="k">this</span><span class="o">.</span><span class="na">errorMessage</span> <span class="o">=</span> <span class="n">errorMessage</span><span class="o">;</span>
    <span class="o">}</span>


    <span class="kd">public</span> <span class="nf">ValidationException</span><span class="o">(</span><span class="nc">Error</span><span class="o">[]</span> <span class="n">errors</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">errors</span> <span class="o">=</span> <span class="n">errors</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">Error</span><span class="o">[]</span> <span class="nf">getErrors</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">errors</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">Long</span> <span class="nf">getErrorCode</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">errorCode</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getErrorMessage</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">errorMessage</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Error</span> <span class="o">{</span>

        <span class="kd">private</span> <span class="nc">String</span> <span class="n">defaultMessage</span><span class="o">;</span>
        <span class="kd">private</span> <span class="nc">String</span> <span class="n">field</span><span class="o">;</span>

        <span class="kd">public</span> <span class="nf">Error</span><span class="o">(</span><span class="nc">String</span> <span class="n">defaultMessage</span><span class="o">,</span> <span class="nc">String</span> <span class="n">field</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">this</span><span class="o">.</span><span class="na">defaultMessage</span> <span class="o">=</span> <span class="n">defaultMessage</span><span class="o">;</span>
            <span class="k">this</span><span class="o">.</span><span class="na">field</span> <span class="o">=</span> <span class="n">field</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getDefaultMessage</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">defaultMessage</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getField</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">field</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>먼저 커스텀된 Excpetion 객체가 필요합니다.</p>

<h3 id="14-2-errorattributeconfig">14-2. ErrorAttributeConfig</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ErrorAttributeConfig</span> <span class="o">{</span>
    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">ErrorAttributes</span> <span class="nf">errorAttributes</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">DefaultErrorAttributes</span><span class="o">()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Object</span><span class="o">&gt;</span> <span class="nf">getErrorAttributes</span><span class="o">(</span><span class="nc">WebRequest</span> <span class="n">webRequest</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">includeStackTrace</span><span class="o">)</span> <span class="o">{</span>
                <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Object</span><span class="o">&gt;</span> <span class="n">errorAttributes</span> <span class="o">=</span> <span class="kd">super</span><span class="o">.</span><span class="na">getErrorAttributes</span><span class="o">(</span><span class="n">webRequest</span><span class="o">,</span><span class="n">includeStackTrace</span><span class="o">);</span>
                <span class="nc">Throwable</span> <span class="n">error</span> <span class="o">=</span> <span class="n">getError</span><span class="o">(</span><span class="n">webRequest</span><span class="o">);</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">error</span> <span class="k">instanceof</span> <span class="nc">ValidationException</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">errorAttributes</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"errors"</span><span class="o">,</span> 					<span class="o">((</span><span class="nc">ValidationException</span><span class="o">)</span><span class="n">error</span><span class="o">).</span><span class="na">getErrors</span><span class="o">());</span>
                    <span class="n">errorAttributes</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"message"</span><span class="o">,</span> <span class="o">((</span><span class="nc">ValidationException</span><span class="o">)</span><span class="n">error</span><span class="o">).</span><span class="na">getErrorMessage</span><span class="o">());</span>
                    <span class="n">errorAttributes</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"errorCode"</span><span class="o">,</span> <span class="o">((</span><span class="nc">ValidationException</span><span class="o">)</span><span class="n">error</span><span class="o">).</span><span class="na">getErrorCode</span><span class="o">());</span>
                <span class="o">}</span>
                <span class="k">return</span> <span class="n">errorAttributes</span><span class="o">;</span>
            <span class="o">}</span>

        <span class="o">};</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>그 다음 커스터마이징을 할 필드들을 등록해주어야 합니다.</p>

<p>여기서는 errors, message, errorCode를 커스터마이징 했습니다.</p>

<p>스프링 5.0부터는 Reactive를 지원하게 되서 패키지의 변경이 있습니다.</p>

<p>Mono와 Webflux를 사용하지 않기때문에 servlet 패키지를 import 해주시면 됩니다.</p>

<p><img src="https://github.com/DaeAkin/spring-validation-example/blob/master/image/Reactive%20vs%20Servlet.png?raw=true" alt="" /></p>

<h3 id="143-validationexcpetion을-적용한-memberservice">14.3 ValidationExcpetion을 적용한 MemberService</h3>

<p>다시 MemberService 클래스로 돌아가 RuntimeException 대신 ValidationException를 던지도록 해보겠습니다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Service</span>
<span class="nd">@AllArgsConstructor</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MemberService</span> <span class="o">{</span>

    <span class="nc">MemberRepository</span> <span class="n">memberRepository</span><span class="o">;</span>

    <span class="nd">@Transactional</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">phoneNumberValidationCheck</span><span class="o">(</span><span class="nc">String</span> <span class="n">phoneNumber</span><span class="o">){</span>
        <span class="nc">Optional</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">&gt;</span> <span class="n">optionalMember</span> <span class="o">=</span> <span class="n">memberRepository</span><span class="o">.</span><span class="na">findByPhoneNumber</span><span class="o">(</span><span class="n">phoneNumber</span><span class="o">);</span>
        <span class="k">if</span><span class="o">(</span><span class="n">optionalMember</span><span class="o">.</span><span class="na">isPresent</span><span class="o">())</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">ValidationException</span><span class="o">(</span><span class="mi">1004L</span><span class="o">,</span><span class="s">"폰 번호 오류!."</span><span class="o">,</span><span class="s">"이미 등록된 번호입니다."</span><span class="o">,</span><span class="s">"phoneNumber"</span><span class="o">);</span>
    <span class="o">}</span>


<span class="o">}</span>
</code></pre></div></div>

<p><img src="https://github.com/DaeAkin/spring-validation-example/blob/master/image/ValidationException%20%EC%82%AC%EC%9A%A9.png?raw=true" alt="" /></p>

<p>똑같이 폰번호를 중복시키면 이미 등록된 번호입니다. 라고 표시됩니다.</p>

<p>UX의 수준이 더 높아졌습니다!</p>

<h2 id="15-postman-validationexcpetion-응답알아보기">15. PostMan ValidationExcpetion 응답알아보기</h2>

<p><img src="https://github.com/DaeAkin/spring-validation-example/blob/master/image/Postman%20ValidationException.png?raw=true" alt="" /></p>

<p>웹으로 테스트를 했지만, 앱에서도 사용한다면 Toast 메세지로 defaultMessage를 보여줄 수도 있으며,</p>

<p>필요하면 errorCode에 따라 앱의 화면이 전환을 해야하는지 규칙을 정할 수도 있습니다.</p>

  </article>
</div><!-- <div class="share-buttons">
  <h6>Share on: </h6>
  <ul>
    <li>
      <a href="https://twitter.com/intent/tweet?text=http://localhost:4000/articles/2019-11/Spring-Validation-index" class="twitter btn" title="Share on Twitter"><i class="fa fa-twitter"></i><span> Twitter</span></a>
    </li>
    <li>
      <a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/articles/2019-11/Spring-Validation-index" class="facebook btn" title="Share on Facebook"><i class="fa fa-facebook"></i><span> Facebook</span></a>
    </li>
    <li>
      <a href="https://plus.google.com/share?url=http://localhost:4000/articles/2019-11/Spring-Validation-index" class="google-plus btn" title="Share on Google Plus"><i class="fa fa-google-plus"></i><span> Google+</span></a>
    </li>
    <li>
      <a href="https://news.ycombinator.com/submitlink?u=http://localhost:4000/articles/2019-11/Spring-Validation-index" class="hacker-news btn" title="Share on Hacker News"><i class="fa fa-hacker-news"></i><span> Hacker News</span></a>
    </li>
    <li>
      <a href="https://www.reddit.com/submit?url=http://localhost:4000/articles/2019-11/Spring-Validation-index" class="reddit btn" title="Share on Reddit"><i class="fa fa-reddit"></i><span> Reddit</span></a>
    </li>
  </ul>
</div><!-- end share-buttons --> 


<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'daeakin';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>



        <footer>
  &copy; 2019 민동현 <i class="fa fa-heart heart-icon"></i>
</footer>

      </div>
    </div>
  </div>
  <script type="text/javascript" src="http://localhost:4000/js/jquery-3.2.1.min.js"></script>
<script type="text/javascript" src="http://localhost:4000/js/main.js"></script>


</body>
</html>
