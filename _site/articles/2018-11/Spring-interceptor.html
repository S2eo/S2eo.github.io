<!DOCTYPE html>
<html lang="en">





<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="description" content="Spring Interceptor소개이번 포스팅은 Spring MVC HandlerInterceptor 를 이해하고 올바르게 사용하는 법을 알아 볼 것이다.개요HandlerInterceptor는 기본적으로 Servlet Filter와 비슷하다.그러나 서블릿 필터는 커스텀 전처리기를...">
  <meta name="keywords" content="민동현 and spring">
  <meta name="author" content="Spring Interceptor | 민동현의 블로그">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#f5f5f5">

  <!-- Twitter Tags -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Spring Interceptor | 민동현의 블로그">
  <meta name="twitter:description" content="Spring Interceptor소개이번 포스팅은 Spring MVC HandlerInterceptor 를 이해하고 올바르게 사용하는 법을 알아 볼 것이다.개요HandlerInterceptor는 기본적으로 Servlet Filter와 비슷하다.그러나 서블릿 필터는 커스텀 전처리기를...">
  
    <meta property="twitter:image" content="http://localhost:4000/img/leonids-logo.png">
  

  <!-- Open Graph Tags -->
  <meta property="og:type" content="blog">
  <meta property="og:url" content="http://localhost:4000/articles/2018-11/Spring-interceptor">
  <meta property="og:title" content="Spring Interceptor | 민동현의 블로그">
  <meta property="og:description" content="Spring Interceptor소개이번 포스팅은 Spring MVC HandlerInterceptor 를 이해하고 올바르게 사용하는 법을 알아 볼 것이다.개요HandlerInterceptor는 기본적으로 Servlet Filter와 비슷하다.그러나 서블릿 필터는 커스텀 전처리기를...">
  
    <meta property="og:image" content="http://localhost:4000/img/leonids-logo.png">
  
  <title>Spring Interceptor | 민동현의 블로그</title>

  <!-- CSS files -->
  <link rel="stylesheet" href="http://localhost:4000/css/font-awesome.min.css">
  <link rel="stylesheet" href="http://localhost:4000/css/main.css">

  <link rel="canonical" href="http://localhost:4000/articles/2018-11/Spring-interceptor">
  <link rel="alternate" type="application/rss+xml" title="민동현의 블로그" href="http://localhost:4000/feed.xml" />

  <!-- Icons -->
  <!-- 16x16 -->
  <link rel="shortcut icon" href="http://localhost:4000/favicon.ico">
  <!-- 32x32 -->
  <link rel="shortcut icon" href="http://localhost:4000/favicon.png">
</head>


<body>
  <div class="row">
    <div class="col s12 m3">
      <div class="table cover">
        

<div class="cover-card table-cell table-middle">
  
  <a href="http://localhost:4000/">
    <img src="http://localhost:4000/img/profile.jpg" alt="" class="avatar">
  </a>
  
  <a href="http://localhost:4000/" class="author_name">민동현</a>
  <span class="author_job">Back End Developer</span>
  <span class="author_bio mbm">JAVA 개발자</span>
  <nav class="nav">
    <ul class="nav-list">
      <li class="nav-item">
        <a href="http://localhost:4000/">home</a>
      </li>
       
      <li class="nav-item">
        <a href="http://localhost:4000/archive/">Archive</a>
      </li>
          
      <li class="nav-item">
        <a href="http://localhost:4000/categories/">Categories</a>
      </li>
             
    </ul>
  </nav>
  <script type="text/javascript">
  // based on http://stackoverflow.com/a/10300743/280842
  function gen_mail_to_link(hs, subject) {
    var lhs,rhs;
    var p = hs.split('@');
    lhs = p[0];
    rhs = p[1];
    document.write("<a class=\"social-link-item\" target=\"_blank\" href=\"mailto");
    document.write(":" + lhs + "@");
    document.write(rhs + "?subject=" + subject + "\"><i class=\"fa fa-fw fa-envelope\"></i><\/a>");
  }
</script>
<div class="social-links">
  <ul>
    
      <li>
      <script>gen_mail_to_link('mindh890@gmail.com', 'Hello from website');</script>
      </li>
    
    
    
    
    <li><a href="http://linkedin.com/in/동현-민-736913183" class="social-link-item" target="_blank"><i class="fa fa-fw fa-linkedin"></i></a></li>
    
    
    
    
    <li><a href="http://github.com/DaeAkin" class="social-link-item" target="_blank"><i class="fa fa-fw fa-github"></i></a></li>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <li><a href="https://t.me/DonghyeonMin" class="social-link-item" target="_blank"><i class="fa fa-fw fa-telegram"></i></a></li>
  </ul>
</div>

</div>

      </div>
    </div>
    <div class="col s12 m9">
      <div class="post-listing">
        <a class="btn" href= "http://localhost:4000/" >
  Home
</a>



<div id="post">
  <header class="post-header">
    <h1 title="Spring Interceptor">Spring Interceptor</h1>
    <span class="post-meta">
      <span class="post-date">
        23 NOV 2018
      </span>
      •
      <span class="read-time" title="Estimated read time">
  
  
    8 mins read
  
</span>

    </span>

  </header>

  <article class="post-content">
    <h1 id="spring-interceptor">Spring Interceptor</h1>

<h2 id="소개">소개</h2>

<p>이번 포스팅은 Spring MVC <em>HandlerInterceptor</em> 를 이해하고 올바르게 사용하는 법을 알아 볼 것이다.</p>

<h2 id="개요">개요</h2>

<p>HandlerInterceptor는 기본적으로 Servlet Filter와 비슷하다.</p>

<p>그러나 서블릿 필터는 커스텀 전처리기를 이용해서 핸들러가 실행되는걸 막아준다.</p>

<p>(즉 컨트롤러를 실행하기전에 어떠한 조건에 따라 요청을 진행할지 말지 막아준다는 )</p>

<p>서블릿 필터는 request 와 response 오브젝트를 다룰 때 강력하다.</p>

<p>기본적인 가이드라인에 따르면 특히 기본적인 핸들러를 분리하거나, 인증체크 같은</p>

<p>핸들러 전처리기 작업에 관련된 작업이면 HandlerInterceptor을 구현하는 것이 가장 좋다.</p>

<p>그와 반대로 필터는 multipart forms이나 GZIP 압축같은 request content 또는 view content를 핸들링할때가 알맞다.</p>

<h2 id="spring-mvc-handler">Spring MVC Handler</h2>

<p>인터셉터를 이해하기 위해서는 <em>HandlerMapping</em> 을 잘 알아야한다.  <em>HandlerMapping</em> 는 URL에 관련된 메소드인데,</p>

<p><u>*DispatchServlet*</u> 이 요청을 처리할 때 호출 할 수 있는 메소드이다.</p>

<p>그리고 <u>*DispatcherServlet*</u> 는 실제 메소드를 호출하기 위해서 <em>HandlerAdapter</em> 를 사용한다.</p>

<p>이제 전반적인 context 설정파일을 이해해보자.</p>

<p>요청을 처리하기 전이나,후 처리를 완료하기전(view단이 렌더링 될때)</p>

<p>어떠한 동작을 수행하기 위해 <em>HandlerInterceptor</em> 를 이용하게 된다.</p>

<p>인터셉터는 중복되는 관심 또는 반복되는 핸들러 코드 (예를 들어 로깅작업)을 처리하기위해 사용된다.</p>

<h2 id="maven-dependency">Maven Dependency</h2>

<p>인터셉터를 사용하기 위해서는 pom.xml에 라이브러리를 추가해줘야한다</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>spring-web<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>5.0.6.RELEASE<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div>

<h2 id="spring-handler-interceptor">Spring Handler Interceptor</h2>

<p>프레임워크에서 <em>HandlerMapping</em> 과 같이쓰는 인터셉터들은 반드시 <em>HandlerInterceptor</em> 인터페이스를 구현해야한다.</p>

<p><em>HandlerInterceptor</em> 는 3가지 메인 메소드가 있다 :</p>

<ul>
  <li>
    <h4 id="prehandle--실제-핸들러가-실행되기전에-호출된다-그러나-view는-아직-생성되지-않음">prehandle() : 실제 핸들러가 실행되기전에 호출된다, 그러나 view는 아직 생성되지 않음.</h4>
  </li>
  <li>
    <h4 id="posthandle--핸들러가-실행되고-나서-호출된다">postHandle() : 핸들러가 실행되고 나서 호출된다.</h4>
  </li>
  <li>
    <h4 id="aftercompletion--요청을-끝내고--view가-생성될때-호출된다">afterCompletion() : 요청을 끝내고 , view가 생성될때 호출된다.</h4>
  </li>
</ul>

<blockquote>
  <h4 id="handlerinterceptor-와-handlerinterceptoradapter의-주요-차이점은">HandlerInterceptor 와 <em>HandlerInterceptorAdapter의</em> 주요 차이점은</h4>

  <h4 id="전자는-위에-언급한-3가지-메소드를-override를-해야하고">전자는 위에 언급한 3가지 메소드를 override를 해야하고,</h4>

  <h4 id="반면에-후자는-필요한-메소드만-구현하면-된다는-차이점이-있다">반면에 후자는 필요한 메소드만 구현하면 된다는 차이점이 있다.</h4>
</blockquote>

<hr />

<blockquote>
  <h4 id="아래는-prehandle을-간단하게-구현한-모습이다">아래는 <em>preHandle()</em>을 간단하게 구현한 모습이다</h4>
</blockquote>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">preHandle</span><span class="o">(</span>
  <span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span>
  <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> 
  <span class="nc">Object</span> <span class="n">handler</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
   <span class="c1">// 코드입력</span>
    <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>return 값은 만약 요청이 핸들러에 의해 계속 진행댄다면 <strong>true</strong> 값을 주고 그게 아니라면 <strong>false를</strong> 준다.</p>

<p>####</p>

<blockquote>
  <h4 id="다음은-posthandle을-구현한-것이다">다음은 <em>postHandle()</em>을 구현한 것이다.</h4>
</blockquote>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">postHandle</span><span class="o">(</span>
  <span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> 
  <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span>
  <span class="nc">Object</span> <span class="n">handler</span><span class="o">,</span> 
  <span class="nc">ModelAndView</span> <span class="n">modelAndView</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="c1">// 코드 입력</span>
<span class="o">}</span>
</code></pre></div></div>

<p>이 메소드는 요청이 <em>HandlerAdapter</em>에 의해 처리된 후 즉시 호출된다. 그러나, view가 생성되기 전이다.</p>

<blockquote>
  <p>마지막으로 우리가 구현해야하는 메소드는 <em>afterCompletion()</em>이다.</p>
</blockquote>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">afterCompletion</span><span class="o">(</span>
  <span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> 
  <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span>
  <span class="nc">Object</span> <span class="n">handler</span><span class="o">,</span> <span class="nc">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// 코드 입력</span>
<span class="o">}</span>
</code></pre></div></div>

<p>view가 성공적으로 생성되면, 요청과 관련된 추가적인 작업을 이용할 수 있다.</p>

<p>마지막으로 숙지해야할 사항은 <em>HandlerInterceptor</em>는 <em>@Controller</em> 어노테이션이 붙은
어떠한 클래스에 인터셉터를 등록할 수 있는 책임을 가진 <em>DefaultAnnotationHandlerMapping</em> 빈에 등록되어있다.
거기에다가 웹 어플리케이션에 인터셉터의 수를 특정할 수 있다.
다른방법도 이용가능한데,
<code class="language-plaintext highlighter-rouge">&lt;mvc:interceptor&gt;</code> 을 이용해서 인터셉터를 등록해줄 수 있다.
이 포스트는 후자를 이용할 것이다.</p>

<h2 id="커스텀-logger-인터셉터">커스텀 Logger 인터셉터</h2>

<p>웹 어플리케이션에 로깅 작업을 하는 예제이다. 첫번째로 <em>HandlerInterceptorAdapter</em>를 상속해야한다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">LoggerInterceptor</span> <span class="kd">extends</span> <span class="nc">HandlerInterceptorAdapter</span> <span class="o">{</span>
    <span class="o">...</span>
<span class="o">}</span>
</code></pre></div></div>

<p>인터셉터 안에 logging 을 활성화 시켜주자.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kd">static</span> <span class="nc">Logger</span> <span class="n">log</span> <span class="o">=</span> <span class="nc">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="nc">LoggerInterceptor</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</code></pre></div></div>

<p>이 작업은 Log4J는 로그를 표시할뿐만 아니라, 현재 어떤 클래스가 특정한 출력에 정보를 기록하고 있는지 나타낸다.
다음으로, 인터셉터 구현에 집중해보자.</p>

<ul>
  <li>
    <h4 id="method-prehandle">Method <em>preHandle()</em></h4>

    <p>이 메소드는 요청을 처리하기전에 호출된다. <strong>return true</strong>로 설정하면 프레임워크에게 추가요청을 허용해준다. (아니면 다음 인터셉터에게) 
만약 <strong>false</strong> 설정하면 요청이 처리됬고, 더 이상 추가 요청을 하지 않는다라고 가정하게된다.</p>

    <p>또한 요청에 관한 파라미터들(어디서 요청이 들어왔는지) 의 정보를 알아낼 수 있다.</p>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">preHandle</span><span class="o">(</span>
  <span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span>
  <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> 
  <span class="nc">Object</span> <span class="n">handler</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
       
    <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"[preHandle]["</span> <span class="o">+</span> <span class="n">request</span> <span class="o">+</span> <span class="s">"]"</span> <span class="o">+</span> <span class="s">"["</span> <span class="o">+</span> <span class="n">request</span><span class="o">.</span><span class="na">getMethod</span><span class="o">()</span>
      <span class="o">+</span> <span class="s">"]"</span> <span class="o">+</span> <span class="n">request</span><span class="o">.</span><span class="na">getRequestURI</span><span class="o">()</span> <span class="o">+</span> <span class="n">getParameters</span><span class="o">(</span><span class="n">request</span><span class="o">));</span>
       
    <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div>    </div>

    <p>볼 수 있듯이, 요청에 대한 기초적인 정보들을 로깅한다.
만약 비밀번호 처럼 민감한 사항은 로그 정보에 안뜨게 할수 있다.
가장 간단한 방법은 데이터들을 * 로 대체하는 것이다.</p>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="nc">String</span> <span class="nf">getParameters</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">StringBuffer</span> <span class="n">posted</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringBuffer</span><span class="o">();</span>
    <span class="nc">Enumeration</span><span class="o">&lt;?&gt;</span> <span class="n">e</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameterNames</span><span class="o">();</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">e</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">posted</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"?"</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">while</span> <span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">hasMoreElements</span><span class="o">())</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">posted</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">posted</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"&amp;"</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="nc">String</span> <span class="n">curr</span> <span class="o">=</span> <span class="o">(</span><span class="nc">String</span><span class="o">)</span> <span class="n">e</span><span class="o">.</span><span class="na">nextElement</span><span class="o">();</span>
        <span class="n">posted</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">curr</span> <span class="o">+</span> <span class="s">"="</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">curr</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s">"password"</span><span class="o">)</span> 
          <span class="o">||</span> <span class="n">curr</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s">"pass"</span><span class="o">)</span>
          <span class="o">||</span> <span class="n">curr</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s">"pwd"</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">posted</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"*****"</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="n">posted</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="n">curr</span><span class="o">));</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="nc">String</span> <span class="n">ip</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getHeader</span><span class="o">(</span><span class="s">"X-FORWARDED-FOR"</span><span class="o">);</span>
    <span class="nc">String</span> <span class="n">ipAddr</span> <span class="o">=</span> <span class="o">(</span><span class="n">ip</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">?</span> <span class="n">getRemoteAddr</span><span class="o">(</span><span class="n">request</span><span class="o">)</span> <span class="o">:</span> <span class="n">ip</span><span class="o">;</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">ipAddr</span><span class="o">!=</span><span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">ipAddr</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">""</span><span class="o">))</span> <span class="o">{</span>
        <span class="n">posted</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"&amp;_psip="</span> <span class="o">+</span> <span class="n">ipAddr</span><span class="o">);</span> 
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">posted</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div>    </div>

    <p>마지막으로 HTTP 요청한 사람의 IP주소를 가져올 수도 있다.</p>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="nc">String</span> <span class="nf">getRemoteAddr</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">String</span> <span class="n">ipFromHeader</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getHeader</span><span class="o">(</span><span class="s">"X-FORWARDED-FOR"</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">ipFromHeader</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">ipFromHeader</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">log</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"ip from proxy - X-FORWARDED-FOR : "</span> <span class="o">+</span> <span class="n">ipFromHeader</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">ipFromHeader</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">request</span><span class="o">.</span><span class="na">getRemoteAddr</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <h4 id="method-posthandle"><strong>Method <em>PostHandle()</em></strong></h4>

    <p>이 메소드는 <em>DispatcherServlet</em>이 아직 view를 렌더를 하지 않았지만, <em>HandlerAdapter</em>가 핸들러를 호출할때 실행된다.</p>

    <p>ModelAndView 나 클라이언트의 요청을 처리하기 위해 걸리는 핸들러 시간을 확인하기 위해 추가적인 속성을 사용할 수 있다.</p>

    <p><em>DispatchServlet</em>이 렌더링 되기 전에 request를 그냥 log로 출력해 볼 것이다.</p>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">postHandle</span><span class="o">(</span>
  <span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> 
  <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span>
  <span class="nc">Object</span> <span class="n">handler</span><span class="o">,</span> 
  <span class="nc">ModelAndView</span> <span class="n">modelAndView</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
       
    <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"[postHandle]["</span> <span class="o">+</span> <span class="n">request</span> <span class="o">+</span> <span class="s">"]"</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <blockquote>
      <h4 id="method-aftercompletion"><strong>Method <em>afterCompletion()</em></strong></h4>
    </blockquote>

    <p>​	만약에 어떠한 exception이 생기면 요청이 끝나고 뷰가 렌더링 될 때, request , response 데이타에 대한 exception 정보를 얻을 수 있다.</p>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">afterCompletion</span><span class="o">(</span>
  <span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span><span class="nc">Object</span> <span class="n">handler</span><span class="o">,</span> <span class="nc">Exception</span> <span class="n">ex</span><span class="o">)</span> 
  <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">ex</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">){</span>
        <span class="n">ex</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"[afterCompletion]["</span> <span class="o">+</span> <span class="n">request</span> <span class="o">+</span> <span class="s">"][exception: "</span> <span class="o">+</span> <span class="n">ex</span> <span class="o">+</span> <span class="s">"]"</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div>    </div>
  </li>
</ul>

<blockquote>
  <h4 id="설정하기">설정하기</h4>
</blockquote>

<p>인터셉터를 스프링 설정에 적용하려면 ,  <code class="language-plaintext highlighter-rouge">WebMvcConfigurer</code>를 구현한 <em>WebConfig</em> 클래스 안에 있는</p>

<p><em>addInterceptors()</em> 메소드를 오버라이드 해야만 한다.</p>

<blockquote>
  <h4 id="클래스를-이용한-설정">클래스를 이용한 설정</h4>
</blockquote>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">addInterceptors</span><span class="o">(</span><span class="nc">InterceptorRegistry</span> <span class="n">registry</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">registry</span><span class="o">.</span><span class="na">addInterceptor</span><span class="o">(</span><span class="k">new</span> <span class="nc">LoggerInterceptor</span><span class="o">());</span>
<span class="o">}</span>
</code></pre></div></div>

<p>아니면 XML 스프링 설정 파일을 수정해도 된다.</p>

<blockquote>
  <h4 id="xml을-이용한-설정">XML을 이용한 설정</h4>
</blockquote>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;mvc:interceptors&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"loggerInterceptor"</span> <span class="na">class=</span><span class="s">"org.baeldung.web.interceptor.LoggerInterceptor"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/mvc:interceptors&gt;</span>
</code></pre></div></div>

<p>설정을 활성화 하면 인터셉터는 활성화 되고, 애플리케이션의 모든 요청들은 적절히 로깅 될것이다.</p>

<p>만약 여러개의 인터셉터들을 설정한다면 <em>PreHandle()</em> 메소드는 설정 순서에따라 실행돌 것이다. 반면에
  <em>postHandle()</em> 과 <em>afterCompletion()</em> 메소드는 역순으로 호출된다.</p>

<p>만약 전체 메소드를 interceptor를 하지않고 해당하는 URL만 interceptor를 사용하고 싶다면 어떻게해야할까?</p>

<blockquote>
  <h4 id="선택적으로-인터셉터-설정하기">선택적으로 인터셉터 설정하기</h4>
</blockquote>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;mvc:interceptors&gt;</span>
  <span class="c">&lt;!-- global 인터셉터 --&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"loggerInterceptor"</span> <span class="na">class=</span><span class="s">"org.baeldung.web.interceptor.LoggerInterceptor"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;mvc:interceptor&gt;</span>
        <span class="nt">&lt;mvc:mapping</span> <span class="na">path=</span><span class="s">"/somepath"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">"com.somepath.interceptor.SomepathInterceptor"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/mvc:interceptor&gt;</span>
<span class="nt">&lt;/mvc:interceptors&gt;</span>
</code></pre></div></div>

<p>다음과 같이 <code class="language-plaintext highlighter-rouge">&lt;mvc:mapping path="/somepath"/&gt;</code> 를 이용해서 URL을 적어주면 된다.</p>

<p>명심해야할 것은 모든 path에게 동작이 가능하게 해놓은 global 인터셉터부터 작동한 후,</p>

<p>그 다음 path가 적힌 인터셉터가 작동한다는 점이다.</p>

<p>이제 DispatcherServlce이 이 설정을 알 수 있도록 설정해보자!</p>

<blockquote>
  <h4 id="webxml">web.xml</h4>
</blockquote>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;servlet&gt;</span>
  <span class="nt">&lt;servlet-name&gt;</span>appServlet<span class="nt">&lt;/servlet-name&gt;</span>
  <span class="nt">&lt;servlet-class&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="nt">&lt;/servlet-class&gt;</span>
  <span class="nt">&lt;init-param&gt;</span>
    <span class="nt">&lt;param-name&gt;</span>contextConfigLocation<span class="nt">&lt;/param-name&gt;</span>
    <span class="nt">&lt;param-value&gt;</span>/WEB-INF/spring/appServlet/servlet-context.xml<span class="nt">&lt;/param-value&gt;</span>
  <span class="nt">&lt;/init-param&gt;</span>
  <span class="nt">&lt;load-on-startup&gt;</span>1<span class="nt">&lt;/load-on-startup&gt;</span>
<span class="nt">&lt;/servlet&gt;</span>
</code></pre></div></div>

<p>web.xml보면 컨텍스트설정파일위치를 <em>DispatcherServlet</em> 가지고 있다.</p>

<p><em>DispatcherServlet이</em> 가지고 있는 설정파일위치에 bean을 작성해줘야 정상적으로 작동이된다.</p>

<h5 id="반드시-dispatcherservlet-에-등록된-context에-interceptor를-정의해줘야-한다는걸-잊지말자"><u>반드시 DispatcherServlet 에 등록된 context에 interceptor를 정의해줘야 한다는걸 잊지말자!</u></h5>

<p><a href="https://1.bp.blogspot.com/-LtOZGN6GCf4/W_aHMNFxBAI/AAAAAAAABEk/pLw8X0ZAC8AYQMHIadsLMMXjmBIviR_CACLcBGAs/s1600/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA%2B2018-11-22%2B%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE%2B7.34.31.png"><img src="https://1.bp.blogspot.com/-LtOZGN6GCf4/W_aHMNFxBAI/AAAAAAAABEk/pLw8X0ZAC8AYQMHIadsLMMXjmBIviR_CACLcBGAs/s640/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA%2B2018-11-22%2B%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE%2B7.34.31.png" alt="img" /></a></p>

  </article>
</div><!-- <div class="share-buttons">
  <h6>Share on: </h6>
  <ul>
    <li>
      <a href="https://twitter.com/intent/tweet?text=http://localhost:4000/articles/2018-11/Spring-interceptor" class="twitter btn" title="Share on Twitter"><i class="fa fa-twitter"></i><span> Twitter</span></a>
    </li>
    <li>
      <a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/articles/2018-11/Spring-interceptor" class="facebook btn" title="Share on Facebook"><i class="fa fa-facebook"></i><span> Facebook</span></a>
    </li>
    <li>
      <a href="https://plus.google.com/share?url=http://localhost:4000/articles/2018-11/Spring-interceptor" class="google-plus btn" title="Share on Google Plus"><i class="fa fa-google-plus"></i><span> Google+</span></a>
    </li>
    <li>
      <a href="https://news.ycombinator.com/submitlink?u=http://localhost:4000/articles/2018-11/Spring-interceptor" class="hacker-news btn" title="Share on Hacker News"><i class="fa fa-hacker-news"></i><span> Hacker News</span></a>
    </li>
    <li>
      <a href="https://www.reddit.com/submit?url=http://localhost:4000/articles/2018-11/Spring-interceptor" class="reddit btn" title="Share on Reddit"><i class="fa fa-reddit"></i><span> Reddit</span></a>
    </li>
  </ul>
</div><!-- end share-buttons --> 


<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'daeakin';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>



        <footer>
  &copy; 2019 민동현 <i class="fa fa-heart heart-icon"></i>
</footer>

      </div>
    </div>
  </div>
  <script type="text/javascript" src="http://localhost:4000/js/jquery-3.2.1.min.js"></script>
<script type="text/javascript" src="http://localhost:4000/js/main.js"></script>


</body>
</html>
