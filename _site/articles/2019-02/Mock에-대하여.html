<!DOCTYPE html>
<html lang="en">





<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="description" content="Mock Framework목(Mock)이 무엇이고 왜 필요하죠?우리가 Junit 으로 테스트를 할때에는 보통 어떤 시스템에 입력을 주었을 때 기대하는 출력이 나오는지를 주로 검증하게 됩니다.단위 테스트에서는 보통 입력 값을 테스트 대상 오브젝트의 메소드의 파라미터로 전달하고 메소드...">
  <meta name="keywords" content="민동현 and spring">
  <meta name="author" content="Mock Framework | 민동현의 블로그">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#f5f5f5">

  <!-- Twitter Tags -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Mock Framework | 민동현의 블로그">
  <meta name="twitter:description" content="Mock Framework목(Mock)이 무엇이고 왜 필요하죠?우리가 Junit 으로 테스트를 할때에는 보통 어떤 시스템에 입력을 주었을 때 기대하는 출력이 나오는지를 주로 검증하게 됩니다.단위 테스트에서는 보통 입력 값을 테스트 대상 오브젝트의 메소드의 파라미터로 전달하고 메소드...">
  
    <meta property="twitter:image" content="http://localhost:4000/img/mock.jpeg">
  

  <!-- Open Graph Tags -->
  <meta property="og:type" content="blog">
  <meta property="og:url" content="http://localhost:4000/articles/2019-02/Mock%EC%97%90-%EB%8C%80%ED%95%98%EC%97%AC">
  <meta property="og:title" content="Mock Framework | 민동현의 블로그">
  <meta property="og:description" content="Mock Framework목(Mock)이 무엇이고 왜 필요하죠?우리가 Junit 으로 테스트를 할때에는 보통 어떤 시스템에 입력을 주었을 때 기대하는 출력이 나오는지를 주로 검증하게 됩니다.단위 테스트에서는 보통 입력 값을 테스트 대상 오브젝트의 메소드의 파라미터로 전달하고 메소드...">
  
    <meta property="og:image" content="http://localhost:4000/img/mock.jpeg">
  
  <title>Mock Framework | 민동현의 블로그</title>

  <!-- CSS files -->
  <link rel="stylesheet" href="http://localhost:4000/css/font-awesome.min.css">
  <link rel="stylesheet" href="http://localhost:4000/css/main.css">

  <link rel="canonical" href="http://localhost:4000/articles/2019-02/Mock%EC%97%90-%EB%8C%80%ED%95%98%EC%97%AC">
  <link rel="alternate" type="application/rss+xml" title="민동현의 블로그" href="http://localhost:4000/feed.xml" />

  <!-- Icons -->
  <!-- 16x16 -->
  <link rel="shortcut icon" href="http://localhost:4000/favicon.ico">
  <!-- 32x32 -->
  <link rel="shortcut icon" href="http://localhost:4000/favicon.png">
</head>


<body>
  <div class="row">
    <div class="col s12 m3">
      <div class="table cover">
        

<div class="cover-card table-cell table-middle">
  
  <a href="http://localhost:4000/">
    <img src="http://localhost:4000/img/profile.jpg" alt="" class="avatar">
  </a>
  
  <a href="http://localhost:4000/" class="author_name">민동현</a>
  <span class="author_job">Back End Developer</span>
  <span class="author_bio mbm">JAVA 개발자</span>
  <nav class="nav">
    <ul class="nav-list">
      <li class="nav-item">
        <a href="http://localhost:4000/">home</a>
      </li>
       
      <li class="nav-item">
        <a href="http://localhost:4000/archive/">Archive</a>
      </li>
          
      <li class="nav-item">
        <a href="http://localhost:4000/categories/">Categories</a>
      </li>
             
    </ul>
  </nav>
  <script type="text/javascript">
  // based on http://stackoverflow.com/a/10300743/280842
  function gen_mail_to_link(hs, subject) {
    var lhs,rhs;
    var p = hs.split('@');
    lhs = p[0];
    rhs = p[1];
    document.write("<a class=\"social-link-item\" target=\"_blank\" href=\"mailto");
    document.write(":" + lhs + "@");
    document.write(rhs + "?subject=" + subject + "\"><i class=\"fa fa-fw fa-envelope\"></i><\/a>");
  }
</script>
<div class="social-links">
  <ul>
    
      <li>
      <script>gen_mail_to_link('mindh890@gmail.com', 'Hello from website');</script>
      </li>
    
    
    
    
    <li><a href="http://linkedin.com/in/동현-민-736913183" class="social-link-item" target="_blank"><i class="fa fa-fw fa-linkedin"></i></a></li>
    
    
    
    
    <li><a href="http://github.com/DaeAkin" class="social-link-item" target="_blank"><i class="fa fa-fw fa-github"></i></a></li>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <li><a href="https://t.me/DonghyeonMin" class="social-link-item" target="_blank"><i class="fa fa-fw fa-telegram"></i></a></li>
  </ul>
</div>

</div>

      </div>
    </div>
    <div class="col s12 m9">
      <div class="post-listing">
        <a class="btn" href= "http://localhost:4000/" >
  Home
</a>

<div class="post-image-feature">
  <img class="feature-image" src=
  
  "http://localhost:4000/img/mock.jpeg"
  
  alt="Mock Framework feature image">

  
</div><!-- /.image-wrap -->



<div id="post">
  <header class="post-header">
    <h1 title="Mock Framework">Mock Framework</h1>
    <span class="post-meta">
      <span class="post-date">
        28 FEB 2019
      </span>
      •
      <span class="read-time" title="Estimated read time">
  
  
    11 mins read
  
</span>

    </span>

  </header>

  <article class="post-content">
    <h2 id="mock-framework">Mock Framework</h2>

<h2 id="목mock이-무엇이고-왜-필요하죠">목(Mock)이 무엇이고 왜 필요하죠?</h2>

<p>우리가 <strong>Junit</strong> 으로 테스트를 할때에는 보통 어떤 시스템에 입력을 주었을 때 기대하는 출력이 나오는지를 주로 검증하게 됩니다.
단위 테스트에서는 보통 입력 값을 테스트 대상 오브젝트의 메소드의 파라미터로 전달하고 메소드의 리턴 값을 출력 값을 보고 검증합니다</p>

<p><strong>다음과 같이 말이죠!</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestEx</span> <span class="o">{</span>

	<span class="c1">//평범하게 파라미터로 들어온 값을 반환하는 함수입니다.</span>
	<span class="kd">public</span> <span class="kt">int</span> <span class="nf">printInteger</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">i</span><span class="o">;</span>
	<span class="o">}</span>
	
	<span class="nd">@Test</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">IntegerTest</span><span class="o">()</span> <span class="o">{</span>
		<span class="c1">// 5가 출력이 되었는지 단위테스트를 해준다.</span>
		<span class="n">assertThat</span><span class="o">(</span><span class="n">printInteger</span><span class="o">(</span><span class="mi">5</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="mi">5</span><span class="o">));</span>
	<span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<p>하지만 이렇게 단순히 리턴 값 출력을 하는것이 아니라 
테스트 오브젝트가 간접적으로 <strong>의존 오브젝트</strong><u>(써드파티 라이브러리 등 내가 만들지 않고 다른사람이 만든 API)</u>가 
그 행위가 제대로 이루어 졌는지 검증하고싶다면 어떻게 할까요? 아래와 같이 검증합니다!</p>

<p><a href="https://3.bp.blogspot.com/-jvlC3LU1VSk/XHUZA7wr4TI/AAAAAAAABIg/Lcqjoxbv4cIIDtv5ZcURf-KFSFK1HHs-wCLcBGAs/s1600/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA%2B2019-02-26%2B%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE%2B7.45.49.png"><img src="https://3.bp.blogspot.com/-jvlC3LU1VSk/XHUZA7wr4TI/AAAAAAAABIg/Lcqjoxbv4cIIDtv5ZcURf-KFSFK1HHs-wCLcBGAs/s640/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA%2B2019-02-26%2B%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE%2B7.45.49.png" alt="img" /></a></p>

<p>이런 경우에는 테스트 대상의 간접적인 출력 결과를 검증해야하고, 
테스트 대상 오브젝트와 의존 오브젝트 사이에서 일어나는 일을 검증할 수 있도록 특별히 설계된
<strong>목 오브젝트(Mock Object)</strong> 라는 것이 있습니다.</p>

<p><strong>목 오브젝트</strong>는 테스트 오브젝트가 정상적으로 실행되도록 도와주면서 테스트 오브젝트와 자신의 사이에서 일어나는 커뮤니케이션 내용을 저장해뒀다가 테스트 결과를 검증하는데 활용할 수 있게 해줍니다.</p>

<p>데이터베이스, 웹서버, 웹애플리케이션서버 ,FTP 서버 등 환경 구축을 위한 작업시간이 필요한 경우에 사용합니다. 
특정 모듈을 갖고 있지 않아서 테스트 환경을 구축하지 못하거나 다른 사람과 협의나 정책이 필요한 경우에 사용됩니다.</p>

<p>예를들어 보겠습니다.</p>

<p>다음은 해당 회원을 삭제하는 Test 코드입니다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">deleteTest</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">memberDao</span><span class="o">.</span><span class="na">deleteMember</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>해당 회원번호를 파라미터로 받아서 회원을 삭제하는 메소드인데요, 
어떻게 이 회원이 삭제 됐는지 확인을 할 수 있을까요?</p>

<p>해당 DB에 들어가서 회원이 삭제 됐는지 확인하면 됩니다.
하지만 DB를 사용하지 않는 기능들이라면요? 
예를 들어 메일을 전송하는 서비스를 작성했다고 생각해봅시다. 메일이 전송됐는지 확인하는 어떻게 확인을 해야할까요?</p>

<h2 id="그래서-등장한게-mockito-프레임워크">그래서 등장한게 Mockito 프레임워크</h2>

<p>Mockito라는 프레임워크는 사용하기도 편리하고, 코드도 직관적이라 많은 인기를 끌고 있는데요, 
Mockito와 같은 목 프레임워크의 특징은 목 클래스를 일일이 준비해둘 필요가 없다는 점 입니다.
간단한 메소드 호출만으로 다이내믹하게 특정 인터페이스를 구현한 테스트용 목 오브젝트를 만들 수 있습니다.</p>

<h2 id="준비하기">준비하기</h2>

<ul>
  <li><strong>Spring version : 4.3.2</strong></li>
  <li><strong>JDK : 1.8</strong></li>
  <li><strong>Junit4</strong></li>
  <li><strong>기본패키지 : com.mock.tutorial</strong></li>
</ul>

<h3 id="의존-라이브러리">의존 라이브러리</h3>

<p>테스트를 하기 위한 Junit을 추가해줍시다.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>junit<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>junit<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>4.12<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div>

<h2 id="시작하기">시작하기</h2>

<p>먼저 Mockito 프레임워크를 사용하기 위해서 라이브러리를 추가해주도록 하겠습니다.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.mockito<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>mockito-all<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>1.9.5<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div>

<p>hamcrest 라이브러리도 추가해주세요.
이 라이브러리는 다른언어에도 존재하는데요, Matcher를 좀 더 문장스럽게 꾸며주는 역할을 해줍니다.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.hamcrest<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>hamcrest-library<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>1.3<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div>

<p><strong>이 예제는 회원가입을 한 사람에게 회원가입 축하 메일을 보내주는 코드를 작성하신다고 생각하시면 됩니다.</strong></p>

<p>프로젝트에서 <strong>com.mock.tutorial.test</strong> , <strong>com.mock.tutorial.service</strong> ,
 <strong>com.mock.tutorial.dao</strong> , <strong>com.mock.tutorial.dto</strong>  패키지를 생성해주세요.</p>

<p>test 패키지 밑에 MailsenderTest 클래스를 하나 생성해주세요</p>

<h4 id="mailsendertestclass">MailsenderTest.class</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">mock</span><span class="o">.</span><span class="na">tutorial</span><span class="o">.</span><span class="na">test</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MailSenderTest</span> <span class="o">{</span>

<span class="o">}</span>
</code></pre></div></div>

<h4 id="memberdtoclass">MemberDto.class</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">mock</span><span class="o">.</span><span class="na">tutorial</span><span class="o">.</span><span class="na">dto</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MemberDto</span> <span class="o">{</span>
	
	<span class="kt">int</span> <span class="n">no</span><span class="o">;</span>
	<span class="nc">String</span> <span class="n">id</span><span class="o">;</span>
	<span class="nc">String</span> <span class="n">pw</span><span class="o">;</span>
	
	<span class="kd">public</span> <span class="nf">MemberDto</span><span class="o">(</span><span class="kt">int</span> <span class="n">no</span><span class="o">,</span><span class="nc">String</span> <span class="n">id</span><span class="o">,</span> <span class="nc">String</span> <span class="n">pw</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">no</span> <span class="o">=</span> <span class="n">no</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">pw</span> <span class="o">=</span> <span class="n">pw</span><span class="o">;</span>
	<span class="o">}</span>
	
	<span class="kd">public</span> <span class="nf">MemberDto</span><span class="o">(</span><span class="nc">String</span> <span class="n">id</span><span class="o">,</span> <span class="nc">String</span> <span class="n">pw</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">pw</span> <span class="o">=</span> <span class="n">pw</span><span class="o">;</span>
	<span class="o">}</span>
	
	<span class="kd">public</span> <span class="kt">int</span> <span class="nf">getNo</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">no</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setNo</span><span class="o">(</span><span class="kt">int</span> <span class="n">no</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">no</span> <span class="o">=</span> <span class="n">no</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="kd">public</span> <span class="nc">String</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">id</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="nc">String</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="kd">public</span> <span class="nc">String</span> <span class="nf">getPw</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">pw</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setPw</span><span class="o">(</span><span class="nc">String</span> <span class="n">pw</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">pw</span> <span class="o">=</span> <span class="n">pw</span><span class="o">;</span>
	<span class="o">}</span>
	
<span class="o">}</span>
</code></pre></div></div>

<h4 id="memberdaoclass">MemberDao.class</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">mock</span><span class="o">.</span><span class="na">tutorial</span><span class="o">.</span><span class="na">dao</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.mock.tutorial.dto.MemberDto</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">MemberDao</span> <span class="o">{</span>	
	<span class="kt">int</span> <span class="nf">insertMember</span><span class="o">(</span><span class="nc">MemberDto</span> <span class="n">member</span><span class="o">);</span>
<span class="o">}</span>

</code></pre></div></div>

<p><strong>service</strong> 패키지 밑에 <strong>MailSender</strong> 인터페이스를 하나 생성하고 다음과 같이 적어주세요.</p>

<h4 id="mailsenderclass">MailSender.class</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">mock</span><span class="o">.</span><span class="na">tutorial</span><span class="o">.</span><span class="na">service</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">MailSender</span> <span class="o">{</span>
	<span class="kt">void</span> <span class="nf">sendMail</span><span class="o">(</span><span class="nc">String</span> <span class="n">user_id</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>같은 패키지안에 <strong>MemberService</strong> 인터페이스를 추가하고 다음 메소드를 선언해주세요.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">MemberService</span> <span class="o">{</span>
	<span class="kt">void</span> <span class="nf">insertMember</span><span class="o">(</span><span class="nc">MemberDto</span> <span class="n">member</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p><strong>그런 다음 오늘의 중요한 클래스인 MemberServiceImpl 클래스를 추가해주세요</strong></p>

<pre><code class="language-java ">package com.mock.tutorial.service;

import com.mock.tutorial.dao.MemberDao;
import com.mock.tutorial.dto.MemberDto;

public class MemberServiceImpl implements MemberService{

	MailSender mailSender;
	
	MemberDao memberDao;
	
	public void setMailSender(MailSender mailSender) {
		this.mailSender = mailSender;
	}
	
	public void setMemberDao(MemberDao memberDao) {
		this.memberDao = memberDao;
	}
	
	
	@Override
	public void insertMember(MemberDto member) {
		//dao를 통해 DB에 해당 member Insert
		memberDao.insertMember(member);
		//가입 축하 메일 보내기
		mailSender.sendMail(member.getId());
	}

}

</code></pre>

<p><strong>저희는 직접적인 메일을 보내주는 서비스를 구현하진 않을거예요.</strong></p>

<p><strong>지금까지의 파일들은 <a href="https://github.com/DaeAkin/Mock-Tutorial/tree/setUp">바로 여기</a> 에 있습니다.</strong></p>

<p>테스트를 하기전에 <strong>MemberServiceImpl</strong> 클래스의 <strong>insertMember</strong> 함수를 보겠습니다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kt">void</span> <span class="nf">insertMember</span><span class="o">(</span><span class="nc">MemberDto</span> <span class="n">member</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">//dao를 통해 DB에 해당 member Insert</span>
    <span class="n">memberDao</span><span class="o">.</span><span class="na">insertMember</span><span class="o">(</span><span class="n">member</span><span class="o">);</span>
    <span class="c1">//가입 축하 메일 보내기</span>
    <span class="n">mailSender</span><span class="o">.</span><span class="na">sendMail</span><span class="o">(</span><span class="n">member</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
<span class="o">}</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">memberDao.insertMember(member)</code> 이 코드는 <strong>Dao에게 해당 member를 데이터베이스에 추가해달라는 코드입니다.</strong></p>

<p>이 코드가 정상적으로 수행 된걸 어떻게 확인 할 수 있을까요?
<strong>데이터베이스에 접근해서 해당 데이터를 뽑아와서 비교를 해보면 될 것입니다.</strong></p>

<p>하지만 가입한 유저에게 가입축하 메일을 보내는 <code class="language-plaintext highlighter-rouge">mailSender.sendMail(member.getId())</code> 코드는
return 값은 <code class="language-plaintext highlighter-rouge">void</code> 인데에다가 memberDao처럼 데이터베이스에서 <code class="language-plaintext highlighter-rouge">해당 데이터를 확인할 수도 없고</code> 
<strong>정상적으로 메일을 보내는 함수가 호출됐는지 확인을 할 수 없는 노릇입니다</strong>.
거기다가 그저 코드를 테스트 하는것이니 테스트를 돌릴때 실제로 메일을 발송하면 안됩니다.</p>

<p>이 문제의 해결방법은 <strong>메일을 발송해주는 함수가 호출이 되었는지</strong>를 확인해주기만 하면 됩니다.</p>

<p>이제 MailSender를 테스트하는 Test 코드를 작성해보도록 하겠습니다.</p>

<h4 id="mailsendertestclass-1">MailsenderTest.class</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">mock</span><span class="o">.</span><span class="na">tutorial</span><span class="o">.</span><span class="na">test</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">mockito</span><span class="o">.</span><span class="na">Mockito</span><span class="o">.</span><span class="na">mock</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.mock.tutorial.service.MailSender</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MailSenderTest</span> <span class="o">{</span>
	<span class="nd">@Test</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">mockMailSenderTest</span><span class="o">()</span> <span class="o">{</span>
		<span class="c1">//목 만들어주기</span>
		<span class="nc">MailSender</span> <span class="n">mockMailSender</span> <span class="o">=</span> <span class="n">mock</span><span class="o">(</span><span class="nc">MailSender</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
		
	<span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<p>테스트용 함수인 <strong>mockMailSenderTest</strong>를 만들어서 그 안에 <strong>Mockito 프레임워크</strong>를 만들어서
<strong>MailSender</strong>만의 <strong>mock</strong> 오브젝트를 만들었습니다.</p>

<p><strong>mock()</strong> 함수는 파라미터로 클래스나 인터페이스를 받습니다. 하지만 주로 인터페이스를 자주 사용하곤 합니다.</p>

<blockquote>
  <p>mock() 파라미터로 인터페이스를 자주 사용되는 이유가 뭔가요?</p>

  <p>TDD(Test Driven Development) 테스트 지향적 개발에서는 클래스를 구현하기전에 
먼저 인터페이스로 테스트를 합니다. 그렇기 때문에 인터페이스를 많이 쓰곤 합니다.</p>
</blockquote>

<p>이제 메일을 전송해보는 테스트를 작성해보겠습니다.</p>

<h4 id="mailsendertestclass-2">MailsenderTest.class</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">mock</span><span class="o">.</span><span class="na">tutorial</span><span class="o">.</span><span class="na">test</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">mockito</span><span class="o">.</span><span class="na">Mockito</span><span class="o">.</span><span class="na">mock</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">mockito</span><span class="o">.</span><span class="na">Mockito</span><span class="o">.</span><span class="na">times</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">mockito</span><span class="o">.</span><span class="na">Mockito</span><span class="o">.</span><span class="na">verify</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.mock.tutorial.dao.MemberDao</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.mock.tutorial.dto.MemberDto</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.mock.tutorial.service.MailSender</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.mock.tutorial.service.MemberServiceImpl</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MailSenderTest</span> <span class="o">{</span>
	<span class="nd">@Test</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">mockMailSenderTest</span><span class="o">()</span> <span class="o">{</span>

		<span class="nc">MemberServiceImpl</span> <span class="n">memberServiceImpl</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MemberServiceImpl</span><span class="o">();</span>
		<span class="c1">//MemberDao 목 생성 </span>
		<span class="nc">MemberDao</span> <span class="n">mockMemberDao</span> <span class="o">=</span> <span class="n">mock</span><span class="o">(</span><span class="nc">MemberDao</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
		<span class="c1">//MailSender 목 생성</span>
		<span class="nc">MailSender</span> <span class="n">mockMailSender</span> <span class="o">=</span> <span class="n">mock</span><span class="o">(</span><span class="nc">MailSender</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
		
		<span class="n">memberServiceImpl</span><span class="o">.</span><span class="na">setMailSender</span><span class="o">(</span><span class="n">mockMailSender</span><span class="o">);</span>
		
		<span class="n">memberServiceImpl</span><span class="o">.</span><span class="na">setMemberDao</span><span class="o">(</span><span class="n">mockMemberDao</span><span class="o">);</span>
		
		<span class="nc">MemberDto</span> <span class="n">member</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MemberDto</span><span class="o">(</span><span class="s">"foo"</span><span class="o">,</span> <span class="s">"1234"</span><span class="o">);</span>
		
		<span class="c1">//foo라는 유저 회원가입</span>
		<span class="n">memberServiceImpl</span><span class="o">.</span><span class="na">insertMember</span><span class="o">(</span><span class="n">member</span><span class="o">);</span>
		
		<span class="c1">// sendMail() 함수가 1번 호출되었는지 확인</span>
		<span class="n">verify</span><span class="o">(</span><span class="n">mockMailSender</span><span class="o">,</span> <span class="n">times</span><span class="o">(</span><span class="mi">1</span><span class="o">)).</span><span class="na">sendMail</span><span class="o">(</span><span class="s">"foo"</span><span class="o">);</span>
	<span class="o">}</span>
	
<span class="o">}</span>
</code></pre></div></div>

<p>테스트할 <strong>MemberService를</strong> 구현한 클래스인 <strong>MemberServiceImpl을</strong> 선언을 해주었습니다.</p>

<p><strong>MemberServiceImpl은</strong> 두개의 클래스를 초기화를 해줘야 하는데요, 
<strong>MemberDao</strong> 와 <strong>MailSender</strong> 입니다. 
하지만 우리는 두개의 클래스를 모두 구현을 하지 않았고, 구현했더라도 그 기능을 실제로 실행할 필요는 없습니다.
그래서 두개 클래스 모두 Mock 오브젝트로 만들어 줍시다.
그저 로직이 알맞게 돌아가고 있는지 테스트를 하기 위해서입니다.
이제 <strong>MemberServiceImpl</strong> 가 의존하고 있는 두개의 클래스는 초기화가 완료되었습니다.</p>

<p>이제 회원가입할 유저를 MemberServiceImpl의 insertMember를 호출해서 메일까지 전송을 해보는 코드는
<code class="language-plaintext highlighter-rouge">memberServiceImpl.insertMember(member)</code> 입니다.</p>

<p>이제 MailSender 클래스의 sendMail() 함수가 유저 “foo” 에게 메일을 보내는 게 정상적으로 실행됐는지 확인하는 코드입니다.</p>

<p><code class="language-plaintext highlighter-rouge">verify(mockMailSender, times(1)).sendMail("foo");</code> 는 sendMail(“foo”) 호출이 1번 되었는지 
확인해주는 코드입니다.</p>

<p>## 스텁이란?</p>

<p>지금의 테스트코드는 함수가 <strong>몇 번</strong> 호출됐는지만 알 수 있고, 어떤 값을 리턴해야하는지 정해주지 않았습니다.
그런데 서비스단에서 <code class="language-plaintext highlighter-rouge">MemberDao</code>객체의 리턴 값에 의해 분기되는 코드를 작성했다면 결과 값을 리턴해주어야 합니다.</p>

<p>하지만 MemberDao는 테스트할 때 Mock 객체로 변경되어서 기능이 없습니다.</p>

<p>이럴때 스텁을 사용합니다. 즉 고정된 결과값을 돌려주는 것이죠.</p>

<p><strong>MemberServiceImpl</strong> 클래스에 있는 insertMember 함수에 <code class="language-plaintext highlighter-rouge">스텁</code>을 추가 해보도록 하겠습니다.</p>

<p><strong>MemberServiceImpl</strong> 클래스로 가서 <code class="language-plaintext highlighter-rouge">insertMember()</code> 함수를 다음과 같이 변경해보겠습니다.</p>

<h4 id="memberserviceimpclass">MemberServiceImp.class</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">insertMember</span><span class="o">(</span><span class="nc">MemberDto</span> <span class="n">member</span><span class="o">)</span> <span class="o">{</span>
		<span class="c1">//dao를 통해 DB에 해당 member Insert</span>
		<span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="n">memberDao</span><span class="o">.</span><span class="na">insertMember</span><span class="o">(</span><span class="n">member</span><span class="o">);</span>
		
		<span class="k">if</span><span class="o">(</span><span class="n">result</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
			<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"회원 가입 실패 !!"</span><span class="o">);</span>
		<span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
			<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"회원 가입 성공 !!"</span><span class="o">);</span>
			<span class="c1">//가입 축하 메일 보내기</span>
			<span class="n">mailSender</span><span class="o">.</span><span class="na">sendMail</span><span class="o">(</span><span class="n">member</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
		<span class="o">}</span>
			
	<span class="o">}</span>
</code></pre></div></div>

<p>SQL에서 Insert가 성공하면 1을 리턴하고 실패하면 0을 리턴하게 됩니다.
그 결과 값에 따라 분기를 해주는 코드를 작성했습니다.</p>

<p>그럼 이제 테스트코드는 어떻게 작성해야 될까요?
이럴땐 어떤 결과 값이 나오도록 <code class="language-plaintext highlighter-rouge">스텁</code>을 이용하면 됩니다.</p>

<h4 id="mailsendertestclass-3">MailsenderTest.class</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MailSenderTest</span> <span class="o">{</span>

	<span class="nd">@Test</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">mockMailSenderTest</span><span class="o">()</span> <span class="o">{</span>

		<span class="nc">MemberServiceImpl</span> <span class="n">memberServiceImpl</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MemberServiceImpl</span><span class="o">();</span>
		<span class="c1">//MemberDao 목 생성 </span>
		<span class="nc">MemberDao</span> <span class="n">mockMemberDao</span> <span class="o">=</span> <span class="n">mock</span><span class="o">(</span><span class="nc">MemberDao</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
		<span class="c1">//MailSender 목 생성</span>
		<span class="nc">MailSender</span> <span class="n">mockMailSender</span> <span class="o">=</span> <span class="n">mock</span><span class="o">(</span><span class="nc">MailSender</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
		
		<span class="n">memberServiceImpl</span><span class="o">.</span><span class="na">setMailSender</span><span class="o">(</span><span class="n">mockMailSender</span><span class="o">);</span>
		
		<span class="n">memberServiceImpl</span><span class="o">.</span><span class="na">setMemberDao</span><span class="o">(</span><span class="n">mockMemberDao</span><span class="o">);</span>
	
		<span class="nc">MemberDto</span> <span class="n">member</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MemberDto</span><span class="o">(</span><span class="s">"foo"</span><span class="o">,</span> <span class="s">"1234"</span><span class="o">);</span>
		<span class="c1">//스텁 생성 </span>
		<span class="c1">//Dao의 insertMember가 호출되면 0을 리턴하라는 뜻</span>
		<span class="n">when</span><span class="o">(</span><span class="n">mockMemberDao</span><span class="o">.</span><span class="na">insertMember</span><span class="o">(</span><span class="n">member</span><span class="o">)).</span><span class="na">thenReturn</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
		
		<span class="c1">//foo라는 유저 회원가입</span>
		<span class="n">memberServiceImpl</span><span class="o">.</span><span class="na">insertMember</span><span class="o">(</span><span class="n">member</span><span class="o">);</span>
		
		<span class="c1">// sendMail() 함수가 1번 호출되었는지 확인</span>
		<span class="n">verify</span><span class="o">(</span><span class="n">mockMailSender</span><span class="o">,</span> <span class="n">times</span><span class="o">(</span><span class="mi">1</span><span class="o">)).</span><span class="na">sendMail</span><span class="o">(</span><span class="s">"foo"</span><span class="o">);</span>
	<span class="o">}</span>
	
<span class="o">}</span>

</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">when(mockMemberDao.insertMember(member)).thenReturn(1);</code> 이 소스는 insertMember가 호출되면 1을 리턴하라는 뜻입니다.</p>

<p>테스트코드를 실행하면 <code class="language-plaintext highlighter-rouge">회원 가입 성공 !!</code> 이 뜨는걸 확인하실 수 있습니다.</p>

<p>반대로 0을 주게되면 테스트코드가 실패하게 됩니다.</p>

<p>이렇게 실제로 DB연결 구현은 안했지만, 추후에 다른팀원이 구현할걸 예상에서 미리 작성하여 협업에 많은 도움을 줄 수 있습니다.</p>

<p>완성된 코드는 <a href="https://github.com/DaeAkin/Mock-Tutorial">여기</a> 에 있습니다.</p>

<h2 id="마치며">마치며</h2>

<p>TDD(Test Drvice Development)인 테스트 지향적 개발은 정말 중요합니다. 잘 만들어진 테스트 코드는 몇초만에 버그를 발견하여 시간적 경제적 비용이 적게들게하고 프로그램 개발단축시간을 많이 줄일 수 있습니다.</p>

<p>테스트 코드를 많이 사용하도록 노력해봅시다!</p>

  </article>
</div><!-- <div class="share-buttons">
  <h6>Share on: </h6>
  <ul>
    <li>
      <a href="https://twitter.com/intent/tweet?text=http://localhost:4000/articles/2019-02/Mock%EC%97%90-%EB%8C%80%ED%95%98%EC%97%AC" class="twitter btn" title="Share on Twitter"><i class="fa fa-twitter"></i><span> Twitter</span></a>
    </li>
    <li>
      <a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/articles/2019-02/Mock%EC%97%90-%EB%8C%80%ED%95%98%EC%97%AC" class="facebook btn" title="Share on Facebook"><i class="fa fa-facebook"></i><span> Facebook</span></a>
    </li>
    <li>
      <a href="https://plus.google.com/share?url=http://localhost:4000/articles/2019-02/Mock%EC%97%90-%EB%8C%80%ED%95%98%EC%97%AC" class="google-plus btn" title="Share on Google Plus"><i class="fa fa-google-plus"></i><span> Google+</span></a>
    </li>
    <li>
      <a href="https://news.ycombinator.com/submitlink?u=http://localhost:4000/articles/2019-02/Mock%EC%97%90-%EB%8C%80%ED%95%98%EC%97%AC" class="hacker-news btn" title="Share on Hacker News"><i class="fa fa-hacker-news"></i><span> Hacker News</span></a>
    </li>
    <li>
      <a href="https://www.reddit.com/submit?url=http://localhost:4000/articles/2019-02/Mock%EC%97%90-%EB%8C%80%ED%95%98%EC%97%AC" class="reddit btn" title="Share on Reddit"><i class="fa fa-reddit"></i><span> Reddit</span></a>
    </li>
  </ul>
</div><!-- end share-buttons --> 


<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'daeakin';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>



        <footer>
  &copy; 2019 민동현 <i class="fa fa-heart heart-icon"></i>
</footer>

      </div>
    </div>
  </div>
  <script type="text/javascript" src="http://localhost:4000/js/jquery-3.2.1.min.js"></script>
<script type="text/javascript" src="http://localhost:4000/js/main.js"></script>


</body>
</html>
